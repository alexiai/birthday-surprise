<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Surprise!</title>

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="assets/backg1.png" as="image">
    <link rel="preload" href="assets/pokemon1.png" as="image">
    <link rel="preload" href="assets/explosion.mp3" as="audio">

    <!-- Load fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap" rel="stylesheet">

    <!-- Load CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Load confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Load critical JS early -->
    <script>
        // Simple preloader to track asset loading
        window.assetsLoaded = false;
        window.assetsToLoad = 0;
        window.assetsLoadedCount = 0;

        function assetLoaded() {
            window.assetsLoadedCount++;
            if (window.assetsLoadedCount >= window.assetsToLoad) {
                window.assetsLoaded = true;
                console.log('All assets loaded!');
            }
        }
    </script>
</head>
<body>
<!-- Preload audio -->
<audio id="pouf-sound" src="assets/pouf.mp3" preload="auto" oncanplaythrough="assetLoaded()"></audio>
<audio id="explosion-sound" src="assets/explosion.mp3" preload="auto" oncanplaythrough="assetLoaded()"></audio>
<audio id="foff-sound" src="assets/foff.mp3" preload="auto" oncanplaythrough="assetLoaded()"></audio>

<!-- Preload video -->
<video id="explosion-video" src="assets/explosion.webm" preload="auto" muted playsinline oncanplaythrough="assetLoaded()"></video>

<!-- Hidden preloader for critical images -->
<div style="display: none;">
    <!-- Preload background images -->
    <img src="assets/backg1.png" onload="assetLoaded()" alt="">
    <img src="assets/backg2.png" onload="assetLoaded()" alt="">

    <!-- Preload a few pokemon images (we'll preload more in JS) -->
    <img src="assets/pokemon1.png" onload="assetLoaded()" alt="">
    <img src="assets/pokemon2.png" onload="assetLoaded()" alt="">
    <img src="assets/pokemon3.png" onload="assetLoaded()" alt="">

    <!-- Preload a few cat images -->
    <img src="cats/cat1.png" onload="assetLoaded()" alt="">
    <img src="cats/cat2.png" onload="assetLoaded()" alt="">
</div>

<div class="main-container">
    <!-- Loading indicator -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading birthday surprise...</p>
    </div>

    <div class="background-wrapper">
        <!-- First background (visible initially) -->
        <img src="assets/backg1.png" class="bg-design bg-design-1 active" alt="Birthday Design"
             loading="eager" onload="assetLoaded()">
        <!-- Second background (shown after explosion) -->
        <img src="assets/backg2.png" class="bg-design bg-design-2" alt="Birthday Celebration"
             loading="lazy" onload="assetLoaded()">

        <div id="flame-container">
            <!-- Flames with positions -->
            <div class="flame" style="top: 40%; left: 44.5%;" onclick="blow(this)"></div>
            <div class="flame" style="top: 39%; left: 50.7%;" onclick="blow(this)"></div>
            <div class="flame" style="top: 40.2%; left: 52.6%;" onclick="blow(this)"></div>
            <div class="flame" style="top: 39%; left: 46.5%;" onclick="blow(this)"></div>
            <div class="flame" style="top: 36.2%; left: 48.4%;" onclick="blow(this)"></div>
        </div>

        <div id="celebration-layer">
            <div id="transition-text" class="transition-text"></div>
            <div id="ransom-title" class="birthday-title"></div>
            <div id="pokemon-stamps"></div>
            <div id="cats-container"></div>
        </div>
    </div>

    <h2 class="instruction">Click the candles to blow them out!</h2>
    <h2 class="instruction">And make a wish!</h2>
</div>

<div id="coord-hud"></div>

<!-- Load main script after DOM is ready -->
<script src="script.js" defer></script>
</body>
</html>